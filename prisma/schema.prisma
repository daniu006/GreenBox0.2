generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Plant {
  id                Int      @id @default(autoincrement())
  name              String
  minTemperature    Float
  maxTemperature    Float
  minHumidity       Float
  maxHumidity       Float
  lightHours        Float
  minSoilMoisture   Float    @default(30.0)
  maxSoilMoisture   Float    @default(80.0)
  minWaterLevel     Float
  wateringFrequency Float
  createdAt         DateTime @default(now())
  boxes             Box[]
  guides            Guide[]

  @@map("plants")
}

model Box {
  id               Int         @id @default(autoincrement())
  code             String      @unique
  name             String
  plantId          Int?
  wateringCount    Int         @default(0)
  lastWateringDate DateTime?
  ledStatus        Boolean     @default(false)
  pumpStatus       Boolean     @default(false)
  createdAt        DateTime    @default(now())
  alerts           Alert[]
  plant            Plant?      @relation(fields: [plantId], references: [id])
  histories        History[]
  readings         Reading[]
  statistics       Statistic[]

  @@index([plantId])
  @@map("boxes")
}

model Reading {
  id           Int      @id @default(autoincrement())
  boxId        Int
  temperature  Float
  humidity     Float
  soilMoisture Float    @default(0.0)
  lightHours   Float
  waterLevel   Float
  timestamp    DateTime @default(now())
  createdAt    DateTime @default(now())
  box          Box      @relation(fields: [boxId], references: [id], onDelete: Cascade)

  @@index([boxId])
  @@index([timestamp])
  @@map("readings")
}

model Statistic {
  id              Int      @id @default(autoincrement())
  boxId           Int
  week            Int
  avgTemperature  Float
  avgHumidity     Float
  avgSoilMoisture Float    @default(0.0)
  avgLightHours   Float
  avgWaterLevel   Float
  estimatedHealth Float
  generatedAt     DateTime @default(now())
  box             Box      @relation(fields: [boxId], references: [id], onDelete: Cascade)

  @@unique([boxId, week])
  @@index([boxId])
  @@map("statistics")
}

model History {
  id              Int      @id @default(autoincrement())
  boxId           Int
  date            DateTime @default(now())
  Type            String
  week            Int
  temperature     Float
  humidity        Float
  soilMoisture    Float    @default(0.0)
  lightHours      Float
  waterLevel      Float
  estimatedHealth Float
  box             Box      @relation(fields: [boxId], references: [id], onDelete: Cascade)

  @@index([boxId, date])
  @@map("histories")
}

model Guide {
  id          Int     @id @default(autoincrement())
  plantId     Int
  title       String
  description String
  step        Int?
  image       String?
  plant       Plant   @relation(fields: [plantId], references: [id], onDelete: Cascade)

  @@index([plantId])
  @@map("guides")
}

model Alert {
  id        Int      @id @default(autoincrement())
  boxId     Int
  type      String
  message   String
  priority  String
  resolved  Boolean  @default(false)
  createdAt DateTime @default(now())
  box       Box      @relation(fields: [boxId], references: [id], onDelete: Cascade)

  @@index([boxId])
  @@index([resolved])
  @@map("alerts")
}
